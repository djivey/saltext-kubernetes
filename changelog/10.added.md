Added support for specifying template context variables and improved spec validation.
